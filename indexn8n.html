<!DOCTYPE html>
<html lang="es" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>David Pastor D√≠az - Portfolio</title>
    
    <!-- n8n Chat Widget -->
    <link href="https://cdn.jsdelivr.net/npm/@n8n/chat/dist/style.css" rel="stylesheet" />
    <script type="module">
        import { createChat } from 'https://cdn.jsdelivr.net/npm/@n8n/chat/dist/chat.bundle.es.js';
        // RECUERDA: Reemplaza la siguiente URL por tu propio webhook de producci√≥n de n8n.
        createChat({
            webhookUrl: 'https://dapadi.app.n8n.cloud/webhook/cb048b13-1fbf-4c5b-988a-f9644a661157/chat'
        });
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #00cfff;
            --secondary-color: #00ff00;
            --accent-color: #ff00ff;
            --bg-light: #ffffff;
            --bg-dark: #121212;
            --surface-light: #f8f9fa;
            --surface-dark: #222222;
            --text-light: #333333;
            --text-dark: #ffffff;
            --text-muted-light: #666666;
            --text-muted-dark: #aaaaaa;
        }

        [data-theme="light"] {
            --bg-color: var(--bg-light);
            --surface-color: var(--surface-light);
            --text-color: var(--text-light);
            --text-muted: var(--text-muted-light);
        }

        [data-theme="dark"] {
            --bg-color: var(--bg-dark);
            --surface-color: var(--surface-dark);
            --text-color: var(--text-dark);
            --text-muted: var(--text-muted-dark);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: var(--surface-color);
            padding: 20px 0;
            text-align: center;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        header h1 {
            font-size: 2.5rem;
            color: var(--primary-color);
        }

        .nav {
            margin-top: 20px;
        }

        .nav-link {
            display: inline-block;
            padding: 10px 15px;
            text-decoration: none;
            color: var(--text-muted);
            font-weight: 500;
            transition: color 0.3s ease, transform 0.2s ease;
        }

        .nav-link:hover, .nav-link.active {
            color: var(--text-color);
            transform: translateY(-2px);
            text-decoration: underline;
        }

        .section {
            padding: 40px 0;
            min-height: 80vh;
        }

        .section-title {
            font-size: 2rem;
            text-align: center;
            margin-bottom: 20px;
        }
        
        #about-me .section-title,
        #projects .section-title,
        #skills .section-title,
        #seo .section-title,
        #contact .section-title {
            color: var(--primary-color);
        }

        /* Hero Section */
        #hero {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 80px 20px;
            background: linear-gradient(45deg, var(--bg-color), var(--surface-color));
        }

        #hero h2 {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        #hero p {
            font-size: 1.2rem;
            color: var(--text-muted);
            max-width: 600px;
        }

        #theme-toggle {
            cursor: pointer;
            border: none;
            background-color: transparent;
            font-size: 1.5rem;
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
            color: var(--text-color);
        }
        
        /* Portfolio Sections */
        .hidden {
            display: none;
        }

        .card {
            background-color: var(--surface-color);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        /* Contact Form */
        #contact-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-width: 600px;
            margin: 0 auto;
        }

        #contact-form input, #contact-form textarea {
            padding: 12px;
            border: 1px solid var(--text-muted);
            border-radius: 8px;
            background-color: var(--surface-color);
            color: var(--text-color);
        }

        #contact-form button {
            padding: 12px 20px;
            background-color: var(--primary-color);
            color: var(--bg-dark);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s ease;
        }

        #contact-form button:hover {
            background-color: var(--secondary-color);
        }

        .status-message {
            margin-top: 10px;
            text-align: center;
            font-weight: bold;
            color: var(--primary-color);
        }

        /* AI Buttons and Spinner */
        #seo-audit-btn, #generate-curiosity-btn, #read-intro-btn, #back-to-projects-btn, #view-project-btn-1, #back-to-detail-btn-1, #login-btn-1, #back-to-dashboard-btn-1, #start-test-btn, #submit-test-btn, #back-to-dashboard-from-results-btn {
            padding: 12px 20px;
            background-color: var(--primary-color);
            color: var(--bg-dark);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s ease;
            margin-top: 20px;
        }

        #seo-audit-btn:hover, #generate-curiosity-btn:hover, #read-intro-btn:hover, #back-to-projects-btn:hover, #view-project-btn-1:hover, #back-to-detail-btn-1:hover, #login-btn-1:hover, #back-to-dashboard-btn-1:hover, #start-test-btn:hover, #submit-test-btn:hover, #back-to-dashboard-from-results-btn:hover {
            background-color: var(--secondary-color);
        }

        .suggestion {
            background-color: var(--surface-color);
            border: 1px solid var(--text-muted);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .loading-spinner {
            border: 4px solid var(--surface-dark);
            border-radius: 50%;
            border-top: 4px solid var(--primary-color);
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .project-action, .skill-action {
            text-align: center;
            margin-top: 60px;
        }
        
        #about-me .flex-row {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        /* Custom class for centering the SEO form content */
        .seo-form-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            max-width: 500px;
            margin: 20px auto;
            gap: 15px;
        }

        /* Added this to center the text above the form */
        .text-center {
            text-align: center;
        }
        
        /* Professional Dashboard Styles */
        .dashboard-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 30px;
            gap: 15px;
            cursor: default;
        }

        .dashboard-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .dashboard-card-icon {
            width: 60px;
            height: 60px;
            background-color: rgba(0, 207, 255, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
        }

        .dashboard-card-icon svg {
            width: 32px;
            height: 32px;
            stroke: var(--primary-color);
        }

        .dashboard-card-content h3 {
            font-size: 1.25rem;
            color: var(--text-color);
            margin-bottom: 8px;
        }

        .dashboard-card-content p {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-bottom: 20px;
            min-height: 54px; /* Set a min-height to align elements */
        }

        /* Custom form elements for the dashboard */
        .custom-select, .custom-input {
            width: 100%;
            padding: 12px;
            margin-top: 10px;
            border: 1px solid var(--text-muted);
            border-radius: 8px;
            background-color: var(--bg-color);
            color: var(--text-color);
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-position: right 15px center;
            background-repeat: no-repeat;
            background-size: 1em;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23aaaaaa' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            cursor: pointer;
        }

        .custom-input[type="date"]::-webkit-calendar-picker-indicator {
            cursor: pointer;
            opacity: 0.6;
        }

        [data-theme="dark"] .custom-input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(1);
        }
        [data-theme="dark"] .custom-select {
             background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23ffffff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
        }

        .custom-select:focus, .custom-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(0, 207, 255, 0.2);
        }

        .dashboard-action-btn {
            width: 100%;
            padding: 12px 20px;
            background-color: transparent;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            margin-top: auto;
        }

        .dashboard-action-btn:hover {
            background-color: var(--primary-color);
            color: var(--bg-dark);
        }

        #start-test-btn {
            background-color: var(--primary-color);
            color: var(--bg-dark);
        }

        #start-test-btn:hover {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
        }

    </style>
</head>
<body>
    <button id="theme-toggle">üåô</button>

    <header>
        <div class="container">
            <h1>David Pastor D√≠az</h1>
            <p>Estudiante de DAW con pasi√≥n por la Inteligencia Artificial</p>
            <nav class="nav">
                <a href="#about-me" class="nav-link active">Sobre m√≠</a>
                <a href="#projects" class="nav-link">Proyectos</a>
                <a href="#skills" class="nav-link">Habilidades</a>
                <a href="#seo" class="nav-link">An√°lisis SEO</a>
                <a href="#contact" class="nav-link">Contacto</a>
            </nav>
        </div>
    </header>

    <main>
        <!-- About Me Section -->
        <section id="about-me" class="section">
            <div class="container">
                <h2 class="section-title">Hola, Soy David</h2>
                <p>Soy un estudiante de Desarrollo de Aplicaciones Web (DAW) con una gran pasi√≥n por el desarrollo web. Me estoy formando para crear experiencias digitales que no solo sean funcionales, sino tambi√©n r√°pidas y accesibles.</p>
            </div>
        </section>

        <!-- Projects Section -->
        <section id="projects" class="section hidden">
            <div class="container">
                <h2 class="section-title">Proyectos</h2>
                <div class="grid">
                    <div class="card" id="project-card-1">
                        <h3>Proyecto Final de Grado</h3>
                        <p>Una p√°gina web completa desarrollada para una autoescuela, como proyecto final de carrera.</p>
                    </div>
                    <div class="card">
                        <h3>Proyecto 2</h3>
                        <p>Un proyecto de chatbot simple desarrollado con JavaScript y una API de IA.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Skills Section -->
        <section id="skills" class="section hidden">
            <div class="container">
                <h2 class="section-title">Habilidades</h2>
                <div class="grid">
                    <div class="card">
                        <h3>Front-End</h3>
                        <ul>
                            <li>HTML, CSS, JavaScript</li>
                            <li>React, Vue.js</li>
                            <li>Tailwind CSS</li>
                        </ul>
                    </div>
                    <div class="card">
                        <h3>Back-End</h3>
                        <ul>
                            <li>Node.js, Express</li>
                            <li>Python, Django</li>
                            <li>Bases de datos (SQL, NoSQL)</li>
                        </ul>
                    </div>
                </div>
                <div class="skill-action">
                    <p id="curiosity-content" class="mb-4">Haz clic en el bot√≥n para conocer un dato curioso sobre IA y computaci√≥n.</p>
                    <button id="generate-curiosity-btn">Generar Curiosidad con IA ‚ú®</button>
                </div>
            </div>
        </section>

        <!-- SEO Section -->
        <section id="seo" class="section hidden">
            <div class="container">
                <h2 class="section-title">An√°lisis SEO de la Web</h2>
                <p class="text-center mb-4">Introduce la URL de tu sitio web y haz clic en el bot√≥n para obtener sugerencias de mejora con IA.</p>
                <div class="seo-form-container">
                    <input type="url" id="url-input" placeholder="https://ejemplo.com" required class="mb-4 w-full md:w-1/2 rounded-md border border-gray-300 p-2 focus:outline-none focus:ring-2 focus:ring-primary-color">
                    <button id="seo-audit-btn">Analizar URL con IA ‚ú®</button>
                </div>
                <div id="seo-report" class="hidden">
                    <h3>Sugerencias de Mejora:</h3>
                    <div id="suggestions" class="grid"></div>
                </div>
            </div>
        </section>

        <!-- Contact Section -->
        <section id="contact" class="section hidden">
            <div class="container">
                <h2 class="section-title">Contacto</h2>
                <form id="contact-form" action="https://formspree.io/f/xqayabpw" method="POST">
                    <input type="text" name="name" placeholder="Tu Nombre" required>
                    <input type="email" name="email" placeholder="Tu Email" required>
                    <textarea name="message" rows="5" placeholder="Tu Mensaje" required></textarea>
                    <button type="submit">Enviar Mensaje</button>
                    <p id="status-message" class="status-message"></p>
                </form>
            </div>
        </section>

        <!-- Project Detail Section 1 -->
        <section id="project-detail-1" class="section hidden">
            <div class="container">
                <h2 class="section-title">Proyecto Final de Grado: Web para Autoescuela</h2>
                <p class="text-center" style="margin-bottom: 30px;">Esta es una descripci√≥n detallada del proyecto. Aqu√≠ puedes incluir capturas de pantalla, enlaces al repositorio de c√≥digo o a la web en producci√≥n, y explicar los retos y soluciones del desarrollo.</p>
                
                <div class="grid">
                    <div class="card">
                        <h3>Tecnolog√≠as Utilizadas</h3>
                        <ul>
                            <li><strong>Frontend:</strong> HTML, CSS, JavaScript</li>
                            <li><strong>Backend:</strong> Node.js con Express</li>
                            <li><strong>Base de Datos:</strong> MongoDB</li>
                            <li><strong>Autenticaci√≥n:</strong> JSON Web Tokens (JWT)</li>
                        </ul>
                    </div>
                     <div class="card">
                        <h3>Caracter√≠sticas Principales</h3>
                        <ul>
                            <li>Registro y login de alumnos y profesores.</li>
                            <li>Sistema de reserva de clases pr√°cticas.</li>
                            <li>Tests te√≥ricos interactivos con correcci√≥n.</li>
                            <li>Panel de administraci√≥n para gestionar usuarios y contenido.</li>
                        </ul>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 40px; display: flex; justify-content: center; gap: 20px;">
                    <button id="view-project-btn-1">Ver Proyecto</button>
                    <button id="back-to-projects-btn">Volver a Proyectos</button>
                </div>
            </div>
        </section>

        <!-- Autoescuela Project Page - Login -->
        <section id="project-autoescuela" class="section hidden">
            <div class="container" style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 80vh;">
                <h2 class="section-title">Autoescuela Novel</h2>
                <div class="card" style="cursor: default; max-width: 400px; width: 100%;">
                    <h3>Acceso de Usuarios</h3>
                    <p>Inicia sesi√≥n para acceder a la plataforma.</p>
                    <input type="email" placeholder="Email" style="margin-top: 15px; width: 100%;" value="alumno@novel.es">
                    <input type="password" placeholder="Contrase√±a" style="margin-top: 10px; width: 100%;" value="12345">
                    <button id="login-btn-1" style="width: 100%; margin-top: 20px;">Acceder</button>
                </div>
                <div style="text-align: center; margin-top: 40px;">
                    <button id="back-to-detail-btn-1">Volver a Detalles</button>
                </div>
            </div>
        </section>

        <!-- Autoescuela Project Dashboard -->
        <section id="project-autoescuela-dashboard" class="section hidden">
            <div class="container">
                <h2 class="section-title">Panel Principal - Autoescuela Novel</h2>
                <div class="grid">
                    <!-- Card 1: Reserva de Clases -->
                    <div class="card dashboard-card">
                        <div class="dashboard-card-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                        </div>
                        <div class="dashboard-card-content">
                            <h3>Reserva de Clases</h3>
                            <p>Consulta el calendario y reserva tus clases pr√°cticas.</p>
                            <select class="custom-select">
                                <option disabled selected>Selecciona un profesor...</option>
                                <option>Oscar</option>
                                <option>Luis</option>
                                <option>Jes√∫s</option>
                            </select>
                            <select class="custom-select">
                                 <option disabled selected>Selecciona un permiso...</option>
                                 <option value="AM">AM - Ciclomotor</option>
                                 <option value="A1">A1 - Motocicleta 125cc</option>
                                 <option value="A2">A2 - Motocicleta</option>
                                 <option value="A">A - Motocicleta (sin l√≠mite)</option>
                                 <option value="B">B - Turismo</option>
                                 <option value="B+E">B+E - Turismo con remolque</option>
                                 <option value="C">C - Cami√≥n</option>
                                 <option value="D">D - Autob√∫s</option>
                            </select>
                            <input type="date" class="custom-input">
                        </div>
                    </div>
                    <!-- Card 2: Tests Te√≥ricos -->
                    <div class="card dashboard-card">
                         <div class="dashboard-card-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 11 12 14 22 4"></polyline><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path></svg>
                        </div>
                        <div class="dashboard-card-content">
                            <h3>Tests Te√≥ricos</h3>
                            <p>Practica para tu examen con nuestros tests interactivos.</p>
                            <button id="start-test-btn" class="dashboard-action-btn">Comenzar Test</button>
                        </div>
                    </div>
                    <!-- Card 3: Panel de Administraci√≥n -->
                    <div class="card dashboard-card">
                         <div class="dashboard-card-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
                        </div>
                        <div class="dashboard-card-content">
                            <h3>Panel de Administraci√≥n</h3>
                            <p>Zona restringida para personal de la autoescuela.</p>
                            <button class="dashboard-action-btn">Acceder</button>
                        </div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 40px;">
                    <button id="back-to-dashboard-btn-1">Volver a Detalles del Proyecto</button>
                </div>
            </div>
        </section>

        <!-- Autoescuela Test Page -->
        <section id="project-autoescuela-test" class="section hidden">
            <div class="container">
                <h2 class="section-title">Test Te√≥rico</h2>
                <form id="test-form">
                    <div id="test-questions-container"></div>
                    <div style="text-align: center; margin-top: 40px;">
                        <button type="button" id="submit-test-btn">Finalizar Test</button>
                    </div>
                </form>
            </div>
        </section>

        <!-- Autoescuela Test Results Page -->
        <section id="project-autoescuela-results" class="section hidden">
            <div class="container">
                <h2 class="section-title">Resultado del Test</h2>
                <div id="test-results-content" style="text-align: center; font-size: 1.2rem;"></div>
                 <div style="text-align: center; margin-top: 40px;">
                    <button id="back-to-dashboard-from-results-btn">Volver al Panel</button>
                </div>
            </div>
        </section>

    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- Element Selectors ---
            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('.section'); // Keep this for the new logic
            const themeToggleBtn = document.getElementById('theme-toggle');
            const seoAuditBtn = document.getElementById('seo-audit-btn');
            const generateCuriosityBtn = document.getElementById('generate-curiosity-btn');
            const contactForm = document.getElementById('contact-form');
            const statusMessage = document.getElementById('status-message');
            const seoReport = document.getElementById('seo-report');
            const suggestionsDiv = document.getElementById('suggestions');
            const curiosityContentDiv = document.getElementById('curiosity-content');
            const urlInput = document.getElementById('url-input');
            const projectCard1 = document.getElementById('project-card-1');
            
            // Autoescuela project elements
            const projectDetail1 = document.getElementById('project-detail-1');
            const backToProjectsBtn = document.getElementById('back-to-projects-btn');
            const viewProjectBtn1 = document.getElementById('view-project-btn-1');
            const projectAutoescuela = document.getElementById('project-autoescuela');
            const backToDetailBtn1 = document.getElementById('back-to-detail-btn-1');
            const loginBtn1 = document.getElementById('login-btn-1');
            const projectAutoescuelaDashboard = document.getElementById('project-autoescuela-dashboard');
            const backToDashboardBtn1 = document.getElementById('back-to-dashboard-btn-1');
            const startTestBtn = document.getElementById('start-test-btn');
            const projectAutoescuelaTest = document.getElementById('project-autoescuela-test');
            const submitTestBtn = document.getElementById('submit-test-btn');
            const projectAutoescuelaResults = document.getElementById('project-autoescuela-results');
            const backToDashboardFromResultsBtn = document.getElementById('back-to-dashboard-from-results-btn');
            const testQuestionsContainer = document.getElementById('test-questions-container');
            const testResultsContent = document.getElementById('test-results-content');
            let currentTestQuestions = [];

            // API key for Gemini API, it will be provided by the environment
            const apiKey = "AIzaSyA275OGiSS7cynMyGrnOEB4LiaPhFRz3EM"; 

            // --- Theme Management ---
            // Set initial theme based on system preference
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.setAttribute('data-theme', 'dark');
                themeToggleBtn.textContent = '‚òÄÔ∏è';
            } else {
                document.documentElement.setAttribute('data-theme', 'light');
                themeToggleBtn.textContent = 'üåô';
            }

            // Function to toggle theme
            themeToggleBtn.addEventListener('click', () => {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                if (currentTheme === 'dark') {
                    document.documentElement.setAttribute('data-theme', 'light');
                    themeToggleBtn.textContent = 'üåô';
                } else {
                    document.documentElement.setAttribute('data-theme', 'dark');
                    themeToggleBtn.textContent = '‚òÄÔ∏è';
                }
            });

            // --- Centralized Navigation Logic ---
            function navigateTo(targetId) {
                // Hide all sections first to prevent overlaps
                sections.forEach(section => {
                    section.classList.add('hidden');
                });
                
                // Show the target section
                const targetSection = document.getElementById(targetId);
                if (targetSection) {
                    targetSection.classList.remove('hidden');
                }
                
                // Update the active state on the main navigation links
                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href') === `#${targetId}`) {
                        link.classList.add('active');
                    }
                });
            }

            // --- Event Listeners ---

            // Main navigation
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href').substring(1);
                    navigateTo(targetId);
                });
            });

            // Contact form submission
            contactForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                statusMessage.textContent = 'Enviando mensaje...';
                const form = e.target;
                const data = new FormData(form);
                
                try {
                    const response = await fetch(form.action, {
                        method: form.method,
                        body: data,
                        headers: { 'Accept': 'application/json' }
                    });
                    
                    if (response.ok) {
                        form.reset();
                        statusMessage.textContent = '¬°Mensaje enviado con √©xito!';
                        statusMessage.style.color = 'var(--primary-color)';
                    } else {
                        const responseData = await response.json();
                        statusMessage.textContent = responseData.errors ? 'Hubo un error: ' + responseData.errors.map(e => e.message).join(', ') : 'Hubo un error al enviar el mensaje.';
                        statusMessage.style.color = 'var(--accent-color)';
                    }
                } catch (error) {
                    statusMessage.textContent = 'Error de conexi√≥n. Por favor, revisa tu red.';
                    statusMessage.style.color = 'var(--accent-color)';
                }
            });
            
            // --- AI & API Functions ---

            // Function to make API calls with retry logic
            async function fetchWithRetry(url, options, retries = 3) {
                for (let i = 0; i < retries; i++) {
                    try {
                        const response = await fetch(url, options);
                        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                        return await response.json();
                    } catch (error) {
                        console.error(`Attempt ${i + 1} failed:`, error);
                        if (i === retries - 1) throw error;
                        await new Promise(res => setTimeout(res, 1000 * (2 ** i)));
                    }
                }
            }
            
            // Base64 to ArrayBuffer converter
            function base64ToArrayBuffer(base64) {
                const binaryString = window.atob(base64);
                const len = binaryString.length;
                const bytes = new Uint8Array(len);
                for (let i = 0; i < len; i++) {
                    bytes[i] = binaryString.charCodeAt(i);
                }
                return bytes.buffer;
            }

            // PCM to WAV converter
            function pcmToWav(pcm16, sampleRate) {
                const buffer = new ArrayBuffer(44 + pcm16.length * 2);
                const view = new DataView(buffer);
                const writeString = (v, o, s) => { for (let i = 0; i < s.length; i++) v.setUint8(o + i, s.charCodeAt(i)); };
                
                writeString(view, 0, 'RIFF');
                view.setUint32(4, 36 + pcm16.length * 2, true);
                writeString(view, 8, 'WAVE');
                writeString(view, 12, 'fmt ');
                view.setUint32(16, 16, true);
                view.setUint16(20, 1, true);
                view.setUint16(22, 1, true);
                view.setUint32(24, sampleRate, true);
                view.setUint32(28, sampleRate * 2, true);
                view.setUint16(32, 2, true);
                view.setUint16(34, 16, true);
                writeString(view, 36, 'data');
                view.setUint32(40, pcm16.length * 2, true);
                
                for (let i = 0; i < pcm16.length; i++) view.setInt16(44 + i * 2, pcm16[i], true);
                
                return new Blob([view], { type: 'audio/wav' });
            }

            // AI SEO audit
            seoAuditBtn.addEventListener('click', async () => {
                const url = urlInput.value;
                if (!url) {
                    suggestionsDiv.innerHTML = `<p style="color: var(--accent-color); text-align: center;">Por favor, introduce una URL v√°lida.</p>`;
                    return;
                }
                
                seoReport.classList.remove('hidden');
                suggestionsDiv.innerHTML = `<div class="loading-spinner"></div><p style="text-align: center; margin-top: 10px;">Analizando y generando sugerencias...</p>`;

                const prompt = `Act√∫a como un experto en SEO. Analiza la URL: ${url} y ofrece 5 sugerencias de mejora de SEO claras y pr√°cticas en espa√±ol, en un formato de lista HTML.`;
                const payload = { contents: [{ parts: [{ text: prompt }] }] };
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                try {
                    const data = await fetchWithRetry(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    const generatedText = data.candidates[0].content.parts[0].text;
                    suggestionsDiv.innerHTML = `<div class="grid">${generatedText}</div>`;
                } catch (error) {
                    suggestionsDiv.innerHTML = `<p style="color: var(--accent-color); text-align: center;">Error al generar las sugerencias.</p>`;
                }
            });

            // AI curiosity generator
            generateCuriosityBtn.addEventListener('click', async () => {
                curiosityContentDiv.innerHTML = `<div class="loading-spinner" style="width: 20px; height: 20px;"></div><p style="text-align: center;">Generando...</p>`;
                const prompt = `Dime una curiosidad interesante sobre IA o inform√°tica en una sola frase concisa.`;
                const payload = { contents: [{ parts: [{ text: prompt }] }] };
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                try {
                    const data = await fetchWithRetry(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    curiosityContentDiv.innerHTML = `<p>${data.candidates[0].content.parts[0].text}</p>`;
                } catch (error) {
                    curiosityContentDiv.innerHTML = `<p style="color: var(--accent-color); text-align: center;">Error al generar la curiosidad.</p>`;
                }
            });
            
            // --- Project Simulation Navigation ---
            projectCard1.addEventListener('click', () => navigateTo('project-detail-1'));
            backToProjectsBtn.addEventListener('click', () => navigateTo('projects'));
            viewProjectBtn1.addEventListener('click', () => navigateTo('project-autoescuela'));
            backToDetailBtn1.addEventListener('click', () => navigateTo('project-detail-1'));
            loginBtn1.addEventListener('click', () => navigateTo('project-autoescuela-dashboard'));
            backToDashboardBtn1.addEventListener('click', () => navigateTo('project-detail-1'));
            startTestBtn.addEventListener('click', () => {
                generateRandomTest();
                navigateTo('project-autoescuela-test');
            });
            submitTestBtn.addEventListener('click', () => {
                correctTest();
                navigateTo('project-autoescuela-results');
            });
            backToDashboardFromResultsBtn.addEventListener('click', () => navigateTo('project-autoescuela-dashboard'));

            // --- Autoescuela Test Logic ---
            const questionBank = [
                { question: "¬øVelocidad m√°xima en autopista para un turismo?", options: ["100 km/h", "120 km/h", "90 km/h"], correct: 1 },
                { question: "Una se√±al triangular con borde rojo indica...", options: ["Peligro", "Prohibici√≥n", "Obligaci√≥n"], correct: 0 },
                { question: "¬øTasa m√°xima de alcoholemia para conductores noveles?", options: ["0.25 mg/l", "0.50 mg/l", "0.15 mg/l"], correct: 2 },
                { question: "Un sem√°foro en √°mbar fijo, ¬øqu√© debe hacer?", options: ["Acelerar", "Detenerse", "Pasar con precauci√≥n"], correct: 1 },
                { question: "¬øEs obligatorio el cintur√≥n en asientos traseros?", options: ["S√≠, siempre", "No", "Solo adultos"], correct: 0 }
            ];

            function generateRandomTest() {
                testQuestionsContainer.innerHTML = '';
                currentTestQuestions = [...questionBank].sort(() => 0.5 - Math.random()).slice(0, 3);
                
                currentTestQuestions.forEach((q, index) => {
                    const questionElement = document.createElement('div');
                    questionElement.className = 'card';
                    questionElement.style.marginBottom = '20px';
                    
                    const optionsHTML = q.options.map((option, optionIndex) => `
                        <div style="margin-top: 10px;">
                            <input type="radio" id="q${index}_o${optionIndex}" name="q${index}" value="${optionIndex}">
                            <label for="q${index}_o${optionIndex}">${option}</label>
                        </div>
                    `).join('');

                    questionElement.innerHTML = `<h4>Pregunta ${index + 1}: ${q.question}</h4>${optionsHTML}`;
                    testQuestionsContainer.appendChild(questionElement);
                });
            }

            function correctTest() {
                let score = currentTestQuestions.reduce((acc, q, index) => {
                    const selected = document.querySelector(`input[name="q${index}"]:checked`);
                    return acc + (selected && parseInt(selected.value) === q.correct ? 1 : 0);
                }, 0);
                
                const total = currentTestQuestions.length;
                const resultMessage = score >= Math.ceil(total / 2) ? '¬°Aprobado!' : 'Has suspendido.';
                
                testResultsContent.innerHTML = `<p>Has acertado <strong>${score}</strong> de <strong>${total}</strong> preguntas.</p><h3>${resultMessage}</h3>`;
            }

            // --- Initial Load ---
            navigateTo('about-me');
        });
    </script>
</body>
</html>




